From fb913663873dbf494a2c6a8a69c03ce936922c02 Mon Sep 17 00:00:00 2001
From: Thom Nichols <tmnichols@gmail.com>
Date: Wed, 10 Apr 2013 11:47:50 -0400
Subject: [PATCH] added README

---
 README.md                                          |    9 +++++++++
 .../smack/ConnectionConfiguration.java             |   20 ++++++++++++++++++++
 source/org/jivesoftware/smack/XMPPConnection.java  |    8 +++++++-
 3 files changed, 36 insertions(+), 1 deletion(-)
 create mode 100644 README.md

diff --git a/README.md b/README.md
new file mode 100644
index 0000000..e6a6b7e
--- /dev/null
+++ b/README.md
@@ -0,0 +1,9 @@
+# Smack XMPP Client for Java
+
+This is a fork of the Smack XMPP client library for Java.  We're adding a few features that 
+hopefully will be merged back into the core.
+
+The official SVN repo can be found here: http://svn.igniterealtime.org/svn/repos/smack/trunk
+
+Check out the [Issues tab](https://github.com/EnerNOC/smack-xmpp/issues) to see what 
+enhancements have been made.
diff --git a/source/org/jivesoftware/smack/ConnectionConfiguration.java b/source/org/jivesoftware/smack/ConnectionConfiguration.java
index 9eb7bb9..6bf72b0 100644
--- a/source/org/jivesoftware/smack/ConnectionConfiguration.java
+++ b/source/org/jivesoftware/smack/ConnectionConfiguration.java
@@ -26,6 +26,7 @@ import org.jivesoftware.smack.util.dns.HostAddress;
 
 import javax.net.SocketFactory;
 import javax.net.ssl.SSLContext;
+import javax.net.ssl.SSLSocket;
 import javax.security.auth.callback.CallbackHandler;
 import java.io.File;
 import java.util.ArrayList;
@@ -66,6 +67,7 @@ public class ConnectionConfiguration implements Cloneable {
     private boolean expiredCertificatesCheckEnabled = false;
     private boolean notMatchingDomainCheckEnabled = false;
     private SSLContext customSSLContext;
+    private String[] cipherSuites;
 
     private boolean compressionEnabled = false;
 
@@ -715,6 +717,24 @@ public class ConnectionConfiguration implements Cloneable {
          */
         disabled
     }
+    
+    /**
+     * Set the allowed TLS cipher suites for this connection
+     * @see SSLSocket#setEnabledCipherSuites(String[])
+     * @see http://docs.oracle.com/javase/7/docs/technotes/guides/security/SunProviders.html#SunJSSEProvider
+     * @param ciphers the list of TLS cipher suites
+     */
+    public void setEnabledCipherSuites( final String[] ciphers ) {
+        this.cipherSuites = ciphers;
+    }
+    
+    /**
+     * Get the list of TLS ciphers to be used for connection.
+     * @return The list of cipher suites.
+     */
+    public String[] getEnabledCipherSuites() {
+        return this.cipherSuites;
+    }
 
     /**
      * Returns the username to use when trying to reconnect to the server.
diff --git a/source/org/jivesoftware/smack/XMPPConnection.java b/source/org/jivesoftware/smack/XMPPConnection.java
index 6512aa9..e883f3f 100644
--- a/source/org/jivesoftware/smack/XMPPConnection.java
+++ b/source/org/jivesoftware/smack/XMPPConnection.java
@@ -1,5 +1,5 @@
 /**
- * $RCSfile$
+/ * $RCSfile$
  * $Revision$
  * $Date$
  *
@@ -875,6 +875,12 @@ public class XMPPConnection extends Connection {
         socket.setKeepAlive(true);
         // Initialize the reader and writer with the new secured version
         initReaderAndWriter();
+        
+        final String[] ciphers = config.getEnabledCipherSuites();
+        if ( ciphers != null ) {
+            ((SSLSocket) socket).setEnabledCipherSuites( ciphers );
+        }
+        
         // Proceed to do the handshake
         ((SSLSocket) socket).startHandshake();
         //if (((SSLSocket) socket).getWantClientAuth()) {
-- 
1.7.9.5

